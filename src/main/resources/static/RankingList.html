<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>排行榜</title>
<link rel="stylesheet" href="css/style.css">
<style type="text/css">
.barrage_box div.p span{ margin-right: 10px 0 0 10px; font-size: 24px;color: #fff;}/*line-height: 40px;*/
.barrage{position: fixed;bottom:70px;right:-500px;display: inline-block;width: 500px;z-index: 9999;height: 40px;}
.fh5co-form {
  padding: 30px;
  margin-top: 4em;
  -webkit-box-shadow: -4px 7px 46px 2px rgba(0, 0, 0, 0.1);
  -moz-box-shadow: -4px 7px 46px 2px rgba(0, 0, 0, 0.1);
  -o-box-shadow: -4px 7px 46px 2px rgba(0, 0, 0, 0.1);
  box-shadow: -4px 7px 46px 2px rgba(0, 0, 0, 0.1);
  background: #ffffff;
}

</style>
</head>
<body>
<!--排行榜-->
<h1 style="text-align: center; font-size: 50px; color:#638ECE;">年会答题排行榜</h1>
<div id="div3">
    <div class="col">
        <!-- Start Sign In Form -->
        <form action="#" class="fh5co-form animate-box" data-animate-effect="fadeInLeft">
            <table style="width:100%" id="table-result">
                <thead>
                <tr style="font-size: 30px;color: #333;">
                	<th style="width:20%;background-color: #599BD5; color: #EEFEFF;">排名</th>
                    <th style="width:20%;background-color: #599BD5; color: #EEFEFF;">用户名</th>
                    <th style="width:20%;background-color: #599BD5; color: #EEFEFF;">部门</th>
                    <th style="width:20%;background-color: #599BD5; color: #EEFEFF;">用时</th>
                    <th style="width:20%;background-color: #599BD5; color: #EEFEFF;">分数</th>
                </tr>
                </thead>
                <tbody id="tbody-result" style="text-align: center;">
                </tbody>
            </table>
        </form>
        <!-- END Sign In Form -->
    </div>
</div>
</body>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript" src="js/jquery.barrager.js"></script>
<!-- websocket -->
<script type="text/javascript">
var host = window.location.hostname;
	var websocket = null;
	if ('WebSocket' in window) {
   		 websocket = new WebSocket("ws://"+host+"/Manage");
	}

	websocket.onmessage = function(event){
		console.log(event.data);
		var json=null;
		try{
			json=JSON.parse(event.data)
		}
		catch(e){
		}
		if(json!=null){
			if(json.method=='rank'){
				var user = json.rows;
				console.log(user.length)
				if(user!=null){
					var str = "";
		            for (i in user) {
		            	if(i%2!=0){
		            		str += "<tr style=\"font-size: 30px;color: #000005;\">" +
		                	"<td style='background-color:#EBEEF7;'>" + (parseInt(i)+1) + "</td>" +
		                    "<td style='background-color:#EBEEF7;'>" + user[i].username + "</td>" +
		                    "<td style='background-color:#EBEEF7;'>" + user[i].department + "</td>" +
		                    "<td style='background-color:#EBEEF7;'>" + user[i].timesSecond + "</td>" +
		                    "<td style='background-color:#EBEEF7;'>" + user[i].score + "</td>" +
		                    "</tr>";
		            	}else{
		            		str += "<tr style=\"font-size: 30px;color: #000005;\">" +
		                	"<td style='background-color:#D2DDEF;'>" + (parseInt(i)+1) + "</td>" +
		                    "<td style='background-color:#D2DDEF;'>" + user[i].username + "</td>" +
		                    "<td style='background-color:#D2DDEF;'>" + user[i].department + "</td>" +
		                    "<td style='background-color:#D2DDEF;'>" + user[i].timesSecond + "</td>" +
		                    "<td style='background-color:#D2DDEF;'>" + user[i].score + "</td>" +
		                    "</tr>";
		            	}
		            }
		            $('#tbody-result').html(str);
				}
			}
		}
	}
    var websocketChat;
    //判断当前浏览器是否支持WebSocket
        if ('websocketChat' in window) {
            websocketChat = new WebSocket("ws://dazhizhi.free.ngrok.cc/chat");
        }
        else {
            alert('Not support websocketChat')
        }

        //接收到消息的回调方法
        websocketChat.onmessage = function (event) {
            console.log(event.data);
            var i = Math.round(Math.random() * 7);
            var item = {
                info: event.data, //文字
                href: '', //链接
                close: true, //显示关闭按钮
                speed: 10, //延迟,单位秒,默认6
                top: i, //距离底部高度,单位px,默认随机
                color: '#ffffff', //颜色,默认白色
                old_ie_color: '#ffffff' //ie低版兼容色,不能与网页背景相同,默认黑色
            }
            $('body').barrager(item);
        }

        websocketChat.onerror = function () {
            websocketChat = new WebSocket("ws://dazhizhi.free.ngrok.cc/chat");

}
</script>
</html>