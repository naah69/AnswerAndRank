<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>demo</title>
</head>
<link rel="stylesheet" href="../js/layui/css/layui.css"/>
<body>

<!--用户信息初始化-->
<div id="div1">
    <p>用户名:<input type="text" id="username" name="username"></p>
    <p>部门:<input type="text" id="department" name="department"></p>
    <p>电话号码:<input type="text" id="tel" name="tel"></p>
    <p><input type="button" value="开始游戏" id="initBtn"></p>
</div>

<!--答题-->
<div id="div2" style="display: none">
    <h1 id="timeViewer"></h1>
    <h1 id="userTime"></h1>
    <div id="question"></div>
    <div id="answers">
        <form id="form1">
            <input type="hidden" id="id" name="id">
            <p><input type="radio" id="a1r" name="answer" value="1"><span id="answer1"></span></p>
            <p><input type="radio" id="a2r" name="answer" value="2"><span id="answer2"></span></p>
            <p><input type="radio" id="a3r" name="answer" value="3"><span id="answer3"></span></p>
            <p><input type="radio" id="a4r" name="answer" value="4"><span id="answer4"></span></p>
        </form>
        <input type="button" value="提交" id="comit">
    </div>

</div>
<button onclick="rank()">排行榜</button>
<!--排行榜-->
<div id="div3" style="display: none">
    <table class="layui-hide" id="annualMeeting_question_table" lay-filter="annualMeeting_question_table"></table>

    <!--等待-->
    <h1 id="wait" style="display: none"></h1>
</div>
<script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.js"></script>
<script type="text/javascript" src="js/layui/layui.js"></script>
<script src="js/websocket.js"></script>
<script>

    var table = null;

    $('#initBtn').on('click', function () {
        var message = {
            "method": "init",
            "user": {"username": $('#username').val(), "department": $('#department').val(), "tel": $('#tel').val()}
        };
        send(JSON.stringify(message));
    });
    var isCommit = false;
    $('#comit').on('click', function () {
        var time = intervalSecond - timesRun;
        var message = {
            "method": "updateScore",
            "id": $('#id').val(),
            "answer": $('input:radio:checked').val(),
            "times": time
        };
        isCommit = true;
        clearTime();
        $('#comit').css('display', 'none');
        $('#userTime').text("本次用时：" + time);
        send(JSON.stringify(message));
        $("input[type='radio']").removeAttr('checked');
    });

    function rank() {
        $('#div3').css('display', 'block');
        $.get("/rank", function (data) {
            console.log(data)
            table.reload('annualMeeting_question_table', {
                data: data.rows
            })
        });

    }

    var timesRun = 0;
    var interval;
    var intervalSecond = 12;
    $.get("/intervalSecond",
        function (data) {
            intervalSecond = data;
        });

    function time() {
        timesRun = intervalSecond;
        interval = setInterval(function () {


            if (timesRun == 0) {
                clearTime();
                if (!isCommit && inited) {
                    $('#comit').click();
                }
            } else {
                $('#timeViewer').text(timesRun);
                timesRun--;
            }


        }, 1000);
    }

    function clearTime() {
        if (interval != null && interval != undefined) {
            clearInterval(interval);
        }
    }


    function refreshForm(que) {

        time();
        $('#userTime').text("");
        $('#id').val(que['id']);
        console.log($('#id').val())
        $('#question').text(que['question']);
        $('#answer1').text(que['answerOne']);
        $('#answer1').css('color', 'black');
        $('#answer2').text(que['answerTwo']);
        $('#answer2').css('color', 'black');
        $('#answer3').text(que['answerThree']);
        $('#answer3').css('color', 'black');
        $('#answer4').text(que['answerFour']);
        $('#answer4').css('color', 'black');

    }

    layui.use('table', function () {
        table = layui.table;
        table.render({
            elem: '#annualMeeting_question_table'
            , cols: [[
                {field: 'username', title: '名称', width: '25%'}
                , {field: 'department', title: '部门', width: '25%'}
                , {field: 'score', title: '分数', width: '25%'}
                , {field: 'timesSecond', title: '用时', width: '25%'}
            ]]
            , id: 'annualMeeting_question_table'
        })
    });

</script>

</body>

</html>